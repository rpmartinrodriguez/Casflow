<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIZ-STRATEGIST Supreme Master v10</title>
    
    <!-- 1. Estilos y Fuentes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- 2. Librer铆as Base (Carga Garantizada) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>

    <!-- 3. Firebase Compat SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #020617; 
            color: #f8fafc; 
            margin: 0; 
            height: 100vh;
            overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .tab-animate { animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .active-nav { background-color: #4f46e5; color: white; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4); }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const {
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, 
            Legend, ResponsiveContainer, AreaChart, Area, Radar, RadarChart, 
            PolarGrid, PolarAngleAxis, BarChart, Bar, ComposedChart, Cell
        } = Recharts;

        // --- CONFIGURACIN FIREBASE INTEGRADA ---
        const firebaseConfig = {
            apiKey: "AIzaSyBpIUJfaVxDBZZo14ph26fZ--2L5Tfm1NI",
            authDomain: "cash-flow-4aac7.firebaseapp.com",
            projectId: "cash-flow-4aac7",
            storageBucket: "cash-flow-4aac7.firebasestorage.app",
            messagingSenderId: "561130385612",
            appId: "1:561130385612:web:20028060976a759eab9269"
        };

        // Inicializaci贸n Segura
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- MOTOR DE ICONOS ---
        const Icon = ({ name, size = 18, className = "" }) => {
            const LucideIcon = lucide[name] || lucide.HelpCircle;
            return <LucideIcon size={size} className={className} />;
        };

        // --- HELPERS ---
        const safe = (v, fb = 0) => {
            const n = parseFloat(v);
            return isNaN(n) || !isFinite(n) ? fb : n;
        };

        const fmt = (v) => new Intl.NumberFormat('es-AR', { 
            style: 'currency', currency: 'USD', maximumFractionDigits: 0 
        }).format(v);

        const InfoTip = ({ text }) => (
            <div className="group relative inline-block ml-1 align-middle">
                <Icon name="Info" size={14} className="text-indigo-400/50 hover:text-indigo-400 cursor-help" />
                <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-64 p-3 bg-slate-800 text-white text-[10px] rounded-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-2xl border border-slate-700 leading-relaxed font-normal">
                    {text}
                    <div className="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-slate-800"></div>
                </div>
            </div>
        );

        // --- MOTOR FINANCIERO SUPREME (EL CORAZN) ---
        const runProjectEngine = (p) => {
            const months = [];
            const scenarioMult = p.scenario === 'optimistic' ? 1.3 : p.scenario === 'pessimistic' ? 0.7 : 1;
            const mDepr = p.assets.reduce((a, b) => a + (safe(b.value) / (safe(b.life || 1) * 12)), 0);
            const mFixedBase = p.fixedCosts.reduce((a, b) => a + safe(b.amount), 0);
            
            const totalProd = p.products.length || 1;
            const avgCost = p.products.reduce((acc, x) => acc + safe(x.cost), 0) / totalProd;
            const avgMargin = p.products.reduce((acc, x) => acc + safe(x.margin), 0) / totalProd;
            const avgPrice = avgCost * (1 + avgMargin / 100);

            let units = safe(p.initialUnitsTotal);
            let equity = safe(p.investment) - safe(p.loanAmount);
            let cumCash = -equity;
            let loanBal = safe(p.loanAmount);
            let retainedEarnings = 0;
            let accDepr = 0;
            let revHistory = Array(15).fill(0);
            let payback = null;

            for (let i = 1; i <= 12; i++) {
                const inf = Math.pow(1 + (safe(p.inflationRate)/100), i);
                const season = p.seasonality[i-1] || 1;
                const mUnits = units * season * scenarioMult;
                
                const currentPrice = avgPrice * inf;
                const currentCostU = avgCost * inf;
                const rev = mUnits * currentPrice;
                const cogs = mUnits * currentCostU;

                // Impuestos
                const iibb = rev * (safe(p.iibbRate)/100);
                const gateway = rev * (safe(p.gatewayFee)/100);
                const mkt = (mUnits * (safe(p.salesGrowth)/100)) * safe(p.cacCost) * inf;
                const mFixed = mFixedBase * inf;

                // N贸mina + SAC (Mes 6 y 12)
                const cStaff = p.staff.reduce((acc, s) => {
                    const base = (safe(s.basic) + safe(s.additional)) * inf;
                    const tax = safe(s.employerTaxesRate) / 100;
                    const sac = (i === 6 || i === 12) ? (base * 0.5) : 0;
                    return acc + (base + sac) * (1 + tax);
                }, 0);

                const ebitda = rev - cogs - cStaff - mFixed - iibb - gateway - mkt;
                const mRate = (safe(p.loanRate)/100/12);
                const mInt = loanBal * mRate;
                const capRepay = (i <= safe(p.loanTerm)) ? (safe(p.loanAmount)/safe(p.loanTerm)) : 0;
                loanBal = Math.max(0, loanBal - capRepay);

                const ebt = ebitda - mDepr - mInt;
                const taxProfit = ebt > 0 ? ebt * (safe(p.taxRate)/100) : 0;
                const net = ebt - taxProfit;

                revHistory[i] = rev;
                const cashIn = safe(p.collectionDays) >= 30 ? (revHistory[i-1] || 0) : rev;
                const nextUnits = units * (1 + (safe(p.salesGrowth)/100)) * (p.seasonality[i] || 1) * scenarioMult;
                const stockInv = (nextUnits * currentCostU * safe(p.safetyStockMonths)) - (mUnits * currentCostU * safe(p.safetyStockMonths));

                const cf = net + mDepr - capRepay - stockInv - (rev - cashIn);
                cumCash += cf;
                accDepr += mDepr;
                retainedEarnings += net;
                if (cumCash >= 0 && payback === null) payback = i;

                months.push({ 
                    m: `M${i}`, rev, ebitda, net, cf, cumCash, 
                    debt: loanBal, equity: equity + retainedEarnings,
                    assets: { cash: cumCash, inv: mUnits * currentCostU * safe(p.safetyStockMonths), fixed: safe(p.investment) - accDepr },
                    debtSrv: mInt + capRepay,
                    mFixedTotal: cStaff + mFixed
                });
                units *= (1 + (safe(p.salesGrowth) / 100));
            }

            const terminalValue = (months[11]?.cf || 0) * 12;

            return {
                months, van: months[11]?.cumCash + terminalValue, 
                avgPrice, avgCost, payback, equity, terminalValue,
                totalEbitda: months.reduce((a,b)=>a+b.ebitda, 0),
                totalRev: months.reduce((a,b)=>a+b.rev, 0),
                mFixedTotal: months[0]?.mFixedTotal || 0
            };
        };

        // --- COMPONENTE APP ---
        function App() {
            const [activeTab, setActiveTab] = useState('config');
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [scenario, setScenario] = useState('base');
            const [loading, setLoading] = useState(true);
            const [saveStatus, setSaveStatus] = useState('');
            const [user, setUser] = useState(null);

            // --- ESTADOS DE DATOS ---
            const [investment, setInvestment] = useState(0);
            const [discountRate, setDiscountRate] = useState(15);
            const [inflationRate, setInflationRate] = useState(0);
            const [taxRate, setTaxRate] = useState(30);
            const [ivaRate, setIvaRate] = useState(21);
            const [iibbRate, setIibbRate] = useState(3.5);
            const [gatewayFee, setGatewayFee] = useState(5);
            const [safetyStockMonths, setSafetyStockMonths] = useState(1);
            const [collectionDays, setCollectionDays] = useState(0);
            const [cacCost, setCacCost] = useState(0);
            const [loanAmount, setLoanAmount] = useState(0);
            const [loanRate, setLoanRate] = useState(45);
            const [loanTerm, setLoanTerm] = useState(12);
            const [products, setProducts] = useState([]);
            const [staff, setStaff] = useState([]);
            const [fixedCosts, setFixedCosts] = useState([]);
            const [assets, setAssets] = useState([]);
            const [initialUnitsTotal, setInitialUnitsTotal] = useState(0);
            const [salesGrowth, setSalesGrowth] = useState(0);
            const [seasonality, setSeasonality] = useState(Array(12).fill(1));

            // Cargar datos
            useEffect(() => {
                auth.onAuthStateChanged(async (u) => {
                    if (u) {
                        setUser(u);
                        const snap = await db.collection('users').doc(u.uid).get();
                        if (snap.exists) {
                            const d = snap.data();
                            setInvestment(d.investment || 0); setDiscountRate(d.discountRate || 15);
                            setInflationRate(d.inflationRate || 0); setTaxRate(d.taxRate || 30);
                            setProducts(d.products || []); setStaff(d.staff || []);
                            setFixedCosts(d.fixedCosts || []); setAssets(d.assets || []);
                            setInitialUnitsTotal(d.initialUnitsTotal || 0); setSalesGrowth(d.salesGrowth || 0);
                            setSeasonality(d.seasonality || Array(12).fill(1));
                        }
                    } else { auth.signInAnonymously(); }
                    setLoading(false);
                });
            }, []);

            const save = async () => {
                if (!user) return;
                setSaveStatus('...');
                await db.collection('users').doc(user.uid).set({
                    investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee,
                    safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm,
                    products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality
                });
                setSaveStatus('OK');
                setTimeout(() => setSaveStatus(''), 2000);
            };

            const results = useMemo(() => runProjectEngine({
                investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee,
                safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm,
                products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality, scenario
            }), [investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee, safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm, products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality, scenario]);

            // M茅tricas
            const dailyGoal = Math.ceil((results.mFixedTotal / (results.avgPrice - results.avgCost || 1)) / 22);
            const dscr = (results.totalEbitda / 12) / (loanAmount > 0 ? results.months[0].debtSrv : 1);

            const tornado = useMemo(() => {
                const vars = [
                    { n: 'Precio', v: (results.avgPrice * initialUnitsTotal) * 0.1 },
                    { n: 'Costo Unit.', v: -(results.avgCost * initialUnitsTotal) * 0.1 },
                    { n: 'Sueldos', v: -(results.mFixedTotal) * 0.1 },
                    { n: 'Inversi贸n', v: -(investment) * 0.1 }
                ];
                return vars.map(v => ({ n: v.n, impact: Math.abs(v.v / (results.van || 1) * 100).toFixed(1), pos: v.v > 0 }));
            }, [results.van, investment, results.avgPrice, results.avgCost, results.mFixedTotal]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-[#020617] text-indigo-500">
                    <Icon name="Loader2" size={60} className="animate-spin mb-6" />
                    <p className="font-bold tracking-[0.4em] uppercase opacity-40">Biz Strategist Booting...</p>
                </div>
            );

            return (
                <div className="flex h-screen overflow-hidden text-slate-200">
                    {/* SIDEBAR */}
                    <aside className={`transition-all duration-300 bg-[#0f172a] border-r border-slate-800 p-4 flex flex-col ${isSidebarOpen ? 'w-64' : 'w-20'}`}>
                        <div className="flex items-center justify-between mb-10 px-2">
                            {isSidebarOpen && <div className="font-black text-xl text-indigo-400 flex items-center gap-2 tracking-tighter"><Icon name="Target" size={24}/> MASTER FIN</div>}
                            <button onClick={()=>setIsSidebarOpen(!isSidebarOpen)} className="p-2 hover:bg-slate-800 rounded-xl text-slate-400 mx-auto">
                                <Icon name={isSidebarOpen ? "ChevronLeft" : "Menu"} />
                            </button>
                        </div>
                        <nav className="flex-1 space-y-1.5 overflow-y-auto custom-scrollbar pr-1">
                            {[
                                { id: 'config', icon: 'Settings', label: 'Inversi贸n' },
                                { id: 'strategy', icon: 'Zap', label: 'Estrategia' },
                                { id: 'products', icon: 'ShoppingCart', label: 'Cat谩logo' },
                                { id: 'staff', icon: 'Users', label: 'N贸mina' },
                                { id: 'goals', icon: 'Crosshair', label: 'Panel Diario' },
                                { id: 'flow', icon: 'Activity', label: 'Cash Flow' },
                                { id: 'balance', icon: 'Briefcase', label: 'Balance' },
                                { id: 'analysis', icon: 'Gauge', label: 'Rentabilidad' }
                            ].map(item => (
                                <button key={item.id} onClick={()=>setActiveTab(item.id)} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-2xl transition-all ${activeTab === item.id ? 'active-nav' : 'text-slate-400 hover:bg-slate-800'}`}>
                                    <Icon name={item.icon} size={18}/> {isSidebarOpen && <span className="text-sm font-bold">{item.label}</span>}
                                </button>
                            ))}
                        </nav>
                        <div className="pt-6 border-t border-slate-800 space-y-4">
                            {isSidebarOpen && <select value={scenario} onChange={e=>setScenario(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-xs font-bold outline-none cursor-pointer">
                                <option value="base"> Escenario Base</option>
                                <option value="optimistic"> Optimista (+25%)</option>
                                <option value="pessimistic"> Pesimista (-25%)</option>
                            </select>}
                            <button onClick={save} className="w-full bg-indigo-600 py-3 rounded-2xl text-xs font-black shadow-lg flex items-center justify-center gap-2 hover:bg-indigo-500 transition-all">
                                <Icon name="Save" size={16}/> {isSidebarOpen && (saveStatus || "GUARDAR")}
                            </button>
                        </div>
                    </aside>

                    {/* MAIN */}
                    <main className="flex-1 overflow-y-auto p-4 md:p-10 bg-[#020617] custom-scrollbar">
                        <div className="max-w-6xl mx-auto space-y-12 tab-animate">
                            
                            {/* TAB: CONFIGURACION */}
                            {activeTab === 'config' && (
                                <div className="space-y-10">
                                    <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 uppercase tracking-tighter">Bases de Capital</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-2xl space-y-6">
                                            <h3 className="text-indigo-400 font-black text-[10px] uppercase flex items-center gap-2 tracking-widest"><Icon name="DollarSign" size={14}/> Inversi贸n Total</h3>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Inversi贸n Inicial ($)</label>
                                                <input type="number" value={investment} onChange={e=>setInvestment(safe(e.target.value))} className="w-full bg-transparent border-none text-2xl font-mono outline-none text-white" />
                                            </div>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Pr茅stamo Bancario ($)</label>
                                                <input type="number" value={loanAmount} onChange={e=>setLoanAmount(safe(e.target.value))} className="w-full bg-transparent border-none text-xl font-mono outline-none text-indigo-400" />
                                            </div>
                                        </div>
                                        <div className="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-2xl space-y-6">
                                            <h3 className="text-orange-400 font-black text-[10px] uppercase flex items-center gap-2 tracking-widest"><Icon name="TrendingUp" size={14}/> Demanda M1</h3>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Unidades M1 <InfoTip text="Ventas proyectadas para el primer mes." /></label>
                                                <input type="number" value={initialUnitsTotal} onChange={e=>setInitialUnitsTotal(safe(e.target.value))} className="w-full bg-transparent border-none text-2xl font-mono outline-none text-white" />
                                            </div>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Crecim. Mensual (%)</label>
                                                <input type="number" value={salesGrowth} onChange={e=>setSalesGrowth(safe(e.target.value))} className="w-full bg-transparent border-none text-xl font-mono outline-none text-emerald-400" />
                                            </div>
                                        </div>
                                        <div className="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-2xl space-y-4">
                                            <div className="flex justify-between items-center font-black text-[10px] text-purple-400 uppercase tracking-widest">
                                                <span>Gastos Estructura</span>
                                                <button onClick={()=>setFixedCosts([...fixedCosts, {id: Date.now(), amount: 0}])} className="p-1 bg-purple-500/10 rounded-lg"><Icon name="Plus" size={16}/></button>
                                            </div>
                                            <div className="space-y-2 max-h-[180px] overflow-y-auto custom-scrollbar pr-2">
                                                {fixedCosts.map(c => (
                                                    <div key={c.id} className="flex gap-2 group bg-slate-950 p-2 rounded-xl border border-slate-800">
                                                        <input placeholder="Luz, Gas, etc" className="flex-1 bg-transparent text-[10px] outline-none" value={c.concept} onChange={e=>setFixedCosts(fixedCosts.map(x=>x.id===c.id?{...x, concept: e.target.value}:x))} />
                                                        <input type="number" className="w-16 bg-transparent text-[10px] font-mono text-right outline-none" value={c.amount} onChange={e=>setFixedCosts(fixedCosts.map(x=>x.id===c.id?{...x, amount: safe(e.target.value)}:x))} />
                                                        <button onClick={()=>setFixedCosts(fixedCosts.filter(x=>x.id!==c.id))} className="text-slate-700 hover:text-red-500 transition-all opacity-0 group-hover:opacity-100"><Icon name="Trash2" size={12}/></button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    {/* ACTIVOS */}
                                    <div className="bg-slate-900/40 p-8 rounded-[40px] border border-slate-800">
                                        <div className="flex justify-between items-center mb-8">
                                            <h4 className="font-bold flex items-center gap-3 text-indigo-400 uppercase tracking-tighter"><Icon name="Briefcase" size={22}/> Activos y Amortizaci贸n Proyectada</h4>
                                            <button onClick={()=>setAssets([...assets, {id: Date.now(), name: '', value: 0, life: 5}])} className="text-xs bg-indigo-600/10 px-6 py-2 rounded-full font-black border border-indigo-500/20 text-white shadow-xl hover:bg-indigo-600 transition-all">+ AADIR BIEN DE USO</button>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            {assets.map(a => (
                                                <div key={a.id} className="bg-slate-950 p-5 rounded-[28px] border border-slate-800 relative group hover:border-indigo-500/30 transition-all">
                                                    <button onClick={()=>setAssets(assets.filter(x=>x.id!==a.id))} className="absolute top-3 right-3 text-slate-700 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all"><Icon name="Trash2" size={16}/></button>
                                                    <input placeholder="Nombre Activo" className="w-full bg-transparent font-black text-xs mb-3 outline-none border-b border-white/5 uppercase tracking-tighter" value={a.name} onChange={e=>setAssets(assets.map(x=>x.id===a.id?{...x, name:e.target.value}:x))} />
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <div><label className="text-[8px] text-slate-600 block font-bold uppercase mb-1">Costo</label><input type="number" className="w-full bg-slate-900 rounded-xl p-2 text-[10px] font-mono" value={a.value} onChange={e=>setAssets(assets.map(x=>x.id===a.id?{...x, value:safe(e.target.value)}:x))} /></div>
                                                        <div><label className="text-[8px] text-slate-600 block font-bold uppercase mb-1">Vida (Y)</label><input type="number" className="w-full bg-slate-900 rounded-xl p-2 text-[10px] font-mono text-center" value={a.life} onChange={e=>setAssets(assets.map(x=>x.id===a.id?{...x, life:safe(e.target.value)}:x))} /></div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* TAB: STRATEGY */}
                            {activeTab === 'strategy' && (
                                <div className="max-w-5xl mx-auto space-y-10 animate-in">
                                    <h2 className="text-3xl font-black italic border-l-4 border-emerald-500 pl-4 uppercase tracking-tighter">Estrategia Macroecon贸mica</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <div className="glass p-10 rounded-[48px] space-y-8">
                                            <h3 className="text-emerald-400 font-black text-[10px] uppercase flex gap-2 tracking-widest"><Icon name="ShieldCheck"/> Fiscalidad e Impuestos <InfoTip text="Impuestos nacionales y locales que erosionan el margen operativo." /></h3>
                                            <div className="grid grid-cols-2 gap-6">
                                                <div className="bg-slate-950 p-5 rounded-3xl border border-slate-800">
                                                    <label className="text-[10px] text-slate-500 font-bold uppercase mb-1 block">IVA (%)</label>
                                                    <input type="number" value={ivaRate} onChange={e=>setIvaRate(safe(e.target.value))} className="w-full bg-transparent text-2xl font-mono outline-none text-white" />
                                                </div>
                                                <div className="bg-slate-950 p-5 rounded-3xl border border-slate-800">
                                                    <label className="text-[10px] text-slate-500 font-bold uppercase mb-1 block">Gcias/Renta (%)</label>
                                                    <input type="number" value={taxRate} onChange={e=>setTaxRate(safe(e.target.value))} className="w-full bg-transparent text-2xl font-mono outline-none text-white" />
                                                </div>
                                            </div>
                                            <div className="bg-slate-950 p-5 rounded-3xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase mb-1 block">Ingresos Brutos / Comisiones (%)</label>
                                                <input type="number" value={iibbRate} onChange={e=>setIibbRate(safe(e.target.value))} className="w-full bg-transparent text-2xl font-mono outline-none text-red-400" />
                                            </div>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] space-y-8 text-blue-400">
                                            <h3 className="font-black text-[10px] uppercase flex gap-2 tracking-widest"><Icon name="Clock"/> Log铆stica de Caja</h3>
                                            <div className="bg-slate-950 p-5 rounded-3xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-2">Ciclo de Cobro <InfoTip text="30 d铆as significa que las ventas de hoy se cobran el mes que viene." /></label>
                                                <select value={collectionDays} onChange={e=>setCollectionDays(safe(e.target.value))} className="w-full bg-transparent text-2xl font-black outline-none cursor-pointer text-indigo-400">
                                                    <option value="0"> EFECTIVO (CONTADO)</option>
                                                    <option value="30"> A 30 DAS (DIFERIDO)</option>
                                                </select>
                                            </div>
                                            <div className="bg-slate-950 p-5 rounded-3xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Inversi贸n Stock (M) <InfoTip text="Meses de venta futura que compras por adelantado." /></label>
                                                <input type="number" value={safetyStockMonths} onChange={e=>setSafetyStockMonths(safe(e.target.value))} className="w-full bg-transparent text-2xl font-mono outline-none text-white" />
                                            </div>
                                        </div>
                                    </div>
                                    <div className="glass p-10 rounded-[48px]">
                                        <h3 className="text-[10px] font-black uppercase text-slate-500 mb-8 flex gap-2 tracking-widest"><Icon name="Thermometer" size={14}/> Curva de Estacionalidad de Demanda</h3>
                                        <div className="grid grid-cols-6 md:grid-cols-12 gap-3">
                                            {seasonality.map((s, i) => (
                                                <div key={i} className="text-center group">
                                                    <label className="text-[9px] font-black text-slate-600 block mb-2 uppercase">Mes {i+1}</label>
                                                    <input type="number" step="0.1" className="w-full bg-slate-950 border border-slate-800 rounded-xl p-2 text-xs text-center font-mono focus:border-indigo-500 transition-all" value={s} onChange={e=>{
                                                        const n = [...seasonality]; n[i] = safe(e.target.value); setSeasonality(n);
                                                    }} />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* TAB: PRODUCTOS */}
                            {activeTab === 'products' && (
                                <div className="space-y-10 animate-in pb-20">
                                    <div className="flex justify-between items-end">
                                        <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 uppercase tracking-tighter">Cat谩logo de Productos</h2>
                                        <button onClick={()=>setProducts([...products, {id: Date.now(), name: 'Nuevo', cost: 0, margin: 35}])} className="bg-indigo-600 px-8 py-3 rounded-2xl font-black text-xs shadow-2xl hover:bg-indigo-500 transition-all">+ AADIR PRODUCTO</button>
                                    </div>
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                        {products.map(p => (
                                            <div key={p.id} className="bg-slate-900 p-10 rounded-[48px] border border-slate-800 shadow-2xl group transition-all hover:border-indigo-500/30">
                                                <div className="flex justify-between items-center mb-8">
                                                    <div className="flex items-center gap-4"><Icon name="ShoppingCart" size={24} className="text-indigo-400"/><input className="bg-transparent font-black text-2xl outline-none tracking-tighter" value={p.name} onChange={e=>setProducts(products.map(x=>x.id===p.id?{...x, name:e.target.value}:x))} /></div>
                                                    <button onClick={()=>setProducts(products.filter(x=>x.id!==p.id))} className="text-slate-700 hover:text-red-500 transition-all"><Icon name="Trash2" size={22} /></button>
                                                </div>
                                                <div className="grid grid-cols-2 gap-8">
                                                    <div className="bg-slate-950 p-6 rounded-3xl border border-slate-800"><label className="text-[10px] text-slate-500 block uppercase font-black mb-1">Costo ($)</label><input type="number" className="w-full bg-transparent font-mono outline-none text-xl text-white" value={p.cost} onChange={e=>setProducts(products.map(x=>x.id===p.id?{...x, cost:safe(e.target.value)}:x))} /></div>
                                                    <div className="bg-slate-950 p-6 rounded-3xl border border-slate-800"><label className="text-[10px] text-slate-500 block uppercase font-black mb-1">Margen (%)</label><input type="number" className="w-full bg-transparent font-mono outline-none text-xl text-emerald-400" value={p.margin} onChange={e=>setProducts(products.map(x=>x.id===p.id?{...x, margin:safe(e.target.value)}:x))} /></div>
                                                </div>
                                                <div className="mt-8 pt-8 border-t border-white/5 flex justify-between items-center">
                                                    <span className="text-[11px] font-black text-slate-500 uppercase tracking-[0.2em]">Precio de Lista:</span>
                                                    <span className="text-3xl font-black text-white font-mono">{fmt(safe(p.cost)*(1+safe(p.margin)/100))}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* TAB: STAFF */}
                            {activeTab === 'staff' && (
                                <div className="space-y-12 animate-in pb-20">
                                    <div className="flex justify-between items-end text-orange-400">
                                        <h2 className="text-3xl font-black italic border-l-4 border-orange-500 pl-4 uppercase tracking-tighter">Gesti贸n de N贸mina y SAC</h2>
                                        <button onClick={()=>setStaff([...staff, {id: Date.now(), role: 'Cargo', basic: 0, additional: 0, employerTaxesRate: 25}])} className="bg-orange-600 px-8 py-3 rounded-2xl font-black text-xs shadow-2xl text-white hover:bg-orange-500 transition-all">+ AGREGAR PUESTO</button>
                                    </div>
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                        {staff.map(s => (
                                            <div key={s.id} className="bg-slate-900 p-10 rounded-[48px] border border-slate-800 shadow-2xl">
                                                <div className="flex justify-between items-center mb-8 font-bold text-lg"><div className="flex items-center gap-4 tracking-tighter"><Icon name="ReceiptText" size={24} className="text-indigo-400"/><input className="bg-transparent font-black text-xl outline-none" value={s.role} onChange={e=>setStaff(staff.map(x=>x.id===s.id?{...x, role:e.target.value}:x))} /></div><button onClick={()=>setStaff(staff.filter(x=>x.id!==s.id))} className="text-slate-600 hover:text-red-500 transition-all"><Icon name="Trash2" size={20}/></button></div>
                                                <div className="grid grid-cols-3 gap-6">
                                                    <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800 text-center"><label className="text-[9px] text-slate-500 block uppercase font-black mb-1">B谩sico</label><input type="number" className="w-full bg-transparent font-mono outline-none text-sm text-center" value={s.basic} onChange={e=>setStaff(staff.map(x=>x.id===s.id?{...x, basic:safe(e.target.value)}:x))} /></div>
                                                    <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800 text-center"><label className="text-[9px] text-slate-500 block uppercase font-black mb-1">Adic.</label><input type="number" className="w-full bg-transparent font-mono outline-none text-sm text-center" value={s.additional} onChange={e=>setStaff(staff.map(x=>x.id===s.id?{...x, additional:safe(e.target.value)}:x))} /></div>
                                                    <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800 text-center"><label className="text-[9px] text-slate-500 block uppercase font-black mb-1">Patr %</label><input type="number" className="w-full bg-transparent font-mono outline-none text-sm text-center" value={s.employerTaxesRate} onChange={e=>setStaff(staff.map(x=>x.id===s.id?{...x, employerTaxesRate:safe(e.target.value)}:x))} /></div>
                                                </div>
                                                <div className="mt-8 bg-indigo-600/5 p-5 rounded-[32px] border border-indigo-600/10 flex justify-between items-center text-xs">
                                                    <span className="font-black text-indigo-400 uppercase tracking-widest italic">Costo Mensual Real Empleador:</span>
                                                    <span className="text-2xl font-black text-white font-mono">{fmt((safe(s.basic)+safe(s.additional))*(1+safe(s.employerTaxesRate)/100))}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* TAB: PANEL OPERATIVO */}
                            {activeTab === 'goals' && (
                                <div className="space-y-12 animate-in pb-20">
                                    <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 text-white uppercase tracking-tighter">Control de Gesti贸n Diario</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest">Meta de Ventas</p>
                                            <h3 className="text-7xl font-black text-indigo-400 font-mono tracking-tighter">{dailyGoal}</h3>
                                            <p className="text-[9px] text-slate-600 mt-3 font-black uppercase tracking-[0.2em]">Unidades hoy</p>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest">Caja Objetiva</p>
                                            <h3 className="text-3xl font-black text-white font-mono tracking-tighter">{fmt(dailyGoal * results.avgPrice)}</h3>
                                            <p className="text-[9px] text-slate-600 mt-3 font-black uppercase tracking-[0.2em]">Facturaci贸n M铆nima</p>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest">Ratio de Cr茅dito</p>
                                            <h3 className={`text-5xl font-black ${dscr >= 1.2 ? 'text-emerald-400' : 'text-red-400'} font-mono tracking-tighter`}>{dscr.toFixed(2)}</h3>
                                            <p className="text-[9px] text-slate-600 mt-3 font-black uppercase tracking-[0.2em]">Score DSCR</p>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] shadow-2xl border-indigo-500/20 bg-indigo-500/5">
                                            <p className="text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest">Breakeven</p>
                                            <h3 className="text-4xl font-black text-white font-mono tracking-tighter">{Math.ceil(results.mFixedTotal / (results.avgPrice - results.avgCost || 1))}</h3>
                                            <p className="text-[9px] text-slate-500 mt-3 font-black uppercase tracking-[0.2em]">Unidades Cr铆ticas</p>
                                        </div>
                                    </div>
                                    <div className="bg-indigo-600/10 p-12 rounded-[60px] border border-indigo-600/20 flex flex-col md:flex-row gap-12 items-center shadow-2xl">
                                        <div className="w-28 h-28 bg-indigo-600 rounded-full flex items-center justify-center shadow-indigo-600/40 shadow-2xl"><Icon name="CheckCircle2" size={56} className="text-white"/></div>
                                        <div className="flex-1">
                                            <h4 className="text-3xl font-black text-white uppercase tracking-tighter italic">Dictamen Financiero Ejecutivo</h4>
                                            <p className="text-slate-400 text-lg italic leading-relaxed mt-4">
                                                {dscr >= 1.2 ? "Excelente Solvencia: El negocio genera excedentes suficientes tras cubrir la cuota bancaria. Es altamente financiable y s贸lido para la expansi贸n." : "Alerta de Liquidez Cr铆tica: El EBITDA proyectado apenas logra absorber los compromisos de deuda. Se requiere optimizar el mix de productos o inyectar m谩s capital."}
                                                <br/><br/>
                                                <span className="text-indigo-400 font-black uppercase underline tracking-widest">Meta de Hoy:</span> Deb茅s facturar {fmt(dailyGoal * results.avgPrice)} para no erosionar tu patrimonio.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* TAB: FLOW */}
                            {activeTab === 'flow' && (
                                <div className="space-y-10 animate-in pb-20 overflow-x-auto custom-scrollbar">
                                    <h2 className="text-3xl font-black italic border-l-4 border-blue-500 pl-4 text-white uppercase tracking-tighter">Estado de Resultados y Flujo de Caja</h2>
                                    <div className="bg-[#0f172a] border border-slate-800 rounded-[48px] overflow-hidden shadow-2xl">
                                        <table className="w-full text-left text-xs">
                                            <thead className="bg-slate-800/80 border-b border-slate-700">
                                                <tr><th className="px-10 py-7 font-black uppercase text-slate-500 tracking-widest">RUBRO ECONMICO</th>{results.months.map((p, i) => <th key={i} className="px-6 py-7 text-right font-mono text-indigo-400 min-w-[130px] tracking-tighter">{p.m}</th>)}</tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-800/40">
                                                <tr className="hover:bg-white/5 transition-colors"><td className="px-10 py-6 font-bold text-slate-300 italic tracking-tighter">Ventas (Devengado)</td>{results.months.map((p, i) => <td key={i} className="px-6 py-6 text-right font-mono text-emerald-400">{fmt(p.rev)}</td>)}</tr>
                                                <tr className="bg-indigo-500/5 transition-colors font-black"><td className="px-10 py-6 text-indigo-300 uppercase text-[11px] tracking-[0.2em] italic">EBITDA Real</td>{results.months.map((p, i) => <td key={i} className="px-6 py-6 text-right font-mono font-bold text-indigo-300">{fmt(p.ebitda)}</td>)}</tr>
                                                <tr className="bg-slate-950 font-black border-t-4 border-indigo-600/30"><td className="px-10 py-10 text-white text-lg tracking-tighter uppercase italic">CASH FLOW NETO (Caja)</td>{results.months.map((p, i) => <td key={i} className="px-6 py-10 text-right font-mono text-2xl text-blue-400 tracking-tighter">{fmt(p.cf)}</td>)}</tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* TAB: BALANCE */}
                            {activeTab === 'balance' && (
                                <div className="space-y-12 animate-in pb-20 overflow-x-auto custom-scrollbar">
                                    <h2 className="text-3xl font-black italic border-l-4 border-emerald-500 pl-4 text-white uppercase tracking-tighter">Evoluci贸n de Situaci贸n Patrimonial</h2>
                                    <div className="bg-[#0f172a] border border-slate-800 rounded-[48px] overflow-hidden shadow-2xl">
                                        <table className="w-full text-left text-xs">
                                            <thead className="bg-emerald-950/20 border-b border-slate-700">
                                                <tr><th className="px-10 py-7 font-black uppercase text-emerald-400 tracking-widest">RUBROS AL FINAL DEL MES</th>{results.months.map((p, i) => <th key={i} className="px-6 py-7 text-right font-mono text-slate-500 min-w-[130px] tracking-tighter">{p.m}</th>)}</tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-800/40">
                                                <tr className="bg-slate-900/30 hover:bg-white/5 transition-colors"><td className="px-10 py-6 font-bold text-slate-200 tracking-tighter">ACTIVO TOTAL (Caja + Stock + Fijo)</td>{results.months.map((m, i) => <td key={i} className="px-6 py-6 text-right font-mono text-white font-bold">{fmt(m.assets.cash + m.assets.inv + m.assets.fixed)}</td>)}</tr>
                                                <tr className="bg-red-950/10 hover:bg-white/5 transition-colors text-red-400"><td className="px-10 py-6 font-bold uppercase tracking-widest text-[10px]">PASIVO (Deuda Pendiente)</td>{results.months.map((m, i) => <td key={i} className="px-6 py-6 text-right font-mono">{fmt(m.debt)}</td>)}</tr>
                                                <tr className="bg-indigo-600/10 font-black"><td className="px-10 py-10 text-indigo-400 text-lg italic uppercase tracking-tighter">PATRIMONIO NETO REAL</td>{results.months.map((m, i) => <td key={i} className="px-6 py-10 text-right font-mono text-white text-3xl tracking-tighter font-black">{fmt(m.equity)}</td>)}</tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* TAB: RENTABILIDAD */}
                            {activeTab === 'analysis' && (
                                <div className="space-y-16 animate-in pb-20">
                                    <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 text-white uppercase tracking-tighter">An谩lisis de Rentabilidad y Tornado de Stress</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                                        <div className="glass p-12 rounded-[60px] flex flex-col items-center shadow-3xl">
                                            <h4 className="text-[11px] font-black text-slate-500 uppercase tracking-[0.4em] mb-12 italic">Score de Salud Inversionista</h4>
                                            <div className="h-[420px] w-full">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <RadarChart cx="50%" cy="50%" outerRadius="80%" data={[
                                                        { s: 'EBITDA Margin', v: Math.min(100, (results.totalEbitda/results.totalRev)*200) || 0 },
                                                        { s: 'VAN+', v: results.van > 0 ? 95 : 20 },
                                                        { s: 'Bancabilidad', v: Math.min(100, dscr * 50) || 0 },
                                                        { s: 'Escalabilidad', v: Math.min(100, salesGrowth*5) || 0 },
                                                        { s: 'Liquidez/Payback', v: (12 - (results.payback || 12)) * 8.3 }
                                                    ]}>
                                                        <PolarGrid stroke="#334155" />
                                                        <PolarAngleAxis dataKey="s" tick={{ fill: '#94a3b8', fontSize: 10, fontWeight: '900' }} />
                                                        <Radar name="BIZ" dataKey="v" stroke="#6366f1" fill="#6366f1" fillOpacity={0.6} />
                                                        <Tooltip contentStyle={{ backgroundColor: '#0f172a', border: 'none', borderRadius: '16px' }} />
                                                    </RadarChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                        <div className="space-y-10 flex flex-col justify-center">
                                            <div className="bg-slate-900 p-12 rounded-[56px] border-2 border-indigo-500/20 shadow-3xl relative overflow-hidden bg-gradient-to-br from-slate-900 to-indigo-950/20 group">
                                                <Icon name="DollarSign" size={120} className="absolute top-0 right-0 p-4 opacity-5 group-hover:scale-110 group-hover:rotate-12 transition-all duration-500"/>
                                                <p className="text-xs font-black text-indigo-400 uppercase mb-3 tracking-[0.4em]">Valor Actual Neto (VAN)</p>
                                                <h3 className={`text-7xl font-black ${results.van >= 0 ? 'text-white' : 'text-red-400'} font-mono tracking-tighter`}>{fmt(results.van)}</h3>
                                                <p className="text-xs text-slate-500 mt-8 font-bold italic leading-relaxed uppercase tracking-widest opacity-60">Valorizaci贸n total incluyendo terminal perpetuo de salida.</p>
                                            </div>
                                            {/* ANALISIS TORNADO */}
                                            <div className="bg-slate-900 p-10 rounded-[48px] border border-slate-800 shadow-2xl">
                                                <h4 className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-10 text-center italic">Sensibilidad del VAN ante  +/- 10%</h4>
                                                <div className="space-y-8">
                                                    {tornado.map((t, idx) => (
                                                        <div key={idx} className="space-y-2">
                                                            <div className="flex justify-between text-[11px] font-black uppercase">
                                                                <span className="text-slate-400">{t.n}</span>
                                                                <span className={t.pos ? 'text-emerald-400' : 'text-red-400'}>{t.impact}%</span>
                                                            </div>
                                                            <div className="h-3 bg-slate-950 rounded-full border border-white/5 overflow-hidden p-0.5 shadow-inner">
                                                                <div className={`h-full rounded-full transition-all duration-1000 ${t.pos ? 'bg-emerald-500 shadow-[0_0_15px_#10b981]' : 'bg-red-500 shadow-[0_0_15px_#f43f5e]'}`} style={{ width: `${Math.min(Math.abs(parseFloat(t.impact)) * 2, 100)}%` }} />
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="py-24 text-center opacity-10 text-[11px] font-black uppercase tracking-[1.5em] italic border-t border-slate-900">Biz Strategist Supreme Executive Mastery v10.0</div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

