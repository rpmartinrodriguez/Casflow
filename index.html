<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIZ-STRATEGIST Executive Master</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { 
            TrendingUp, Users, Settings, Package, BarChart3, DollarSign, 
            PieChart, Activity, Plus, Trash2, ChevronLeft, Menu, 
            Calculator, Briefcase, Save, Zap, Target, ArrowUpRight,
            ShieldCheck, Percent, Layers, Gauge, Thermometer, Landmark, 
            FileText, ReceiptText, Wallet, Info, Clock, ShoppingCart, 
            Lightbulb, Megaphone, Boxes, Scale, HelpCircle, ArrowRightLeft,
            CheckCircle2, AlertTriangle, Loader2 
        } = lucide-react;

        const {
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, 
            Legend, ResponsiveContainer, AreaChart, Area, Cell, Pie,
            Radar, RadarChart, PolarGrid, PolarAngleAxis, BarChart: BChart, Bar
        } = Recharts;

        // --- FIREBASE PLACEHOLDER (Vincular con tus llaves aqu铆) ---
        // Al usar este archivo en tu propio hosting, puedes inicializar tu Firebase aqu铆.
        const firebaseConfig = {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        // --- UTILIDADES ---
        const safe = (val, fallback = 0) => {
            const n = parseFloat(val);
            return isNaN(n) || !isFinite(n) ? fallback : n;
        };

        const formatUSD = (val) => new Intl.NumberFormat('en-US', { 
            style: 'currency', currency: 'USD', maximumFractionDigits: 0 
        }).format(val);

        const InfoTooltip = ({ text }) => (
            <div className="group relative inline-block ml-1 align-middle">
                <HelpCircle size={14} className="text-indigo-400/50 hover:text-indigo-400 cursor-help transition-all" />
                <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-64 p-3 bg-slate-800 text-white text-[11px] rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-2xl border border-slate-700 leading-relaxed font-medium">
                    {text}
                    <div className="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-slate-800"></div>
                </div>
            </div>
        );

        // --- MOTOR FINANCIERO ---
        const runFinancialEngine = (p) => {
            const months = [];
            const sMult = p.scenario === 'optimistic' ? 1.25 : p.scenario === 'pessimistic' ? 0.75 : 1;
            const mDepr = p.assets.reduce((a, b) => a + (safe(b.value) / (safe(b.life || 1) * 12)), 0);
            const mFixedBase = p.fixedCosts.reduce((a, b) => a + safe(b.amount), 0);
            
            const avgCost = p.products.length > 0 ? p.products.reduce((acc, x) => acc + safe(x.cost), 0) / p.products.length : 0;
            const avgMargin = p.products.length > 0 ? p.products.reduce((acc, x) => acc + safe(x.margin), 0) / p.products.length : 0;
            const avgPrice = avgCost * (1 + avgMargin / 100);

            let units = safe(p.initialUnitsTotal);
            let equity = safe(p.investment) - safe(p.loanAmount);
            let cumCash = -equity;
            let loanBal = safe(p.loanAmount);
            let accDepr = 0;
            let revHist = Array(15).fill(0);
            let payback = null;

            for (let i = 1; i <= 12; i++) {
                const inf = Math.pow(1 + (safe(p.inflationRate)/100), i);
                const season = p.seasonality[i-1] || 1;
                const mUnits = units * season * sMult;
                const price = avgPrice * inf;
                const costU = avgCost * inf;
                const rev = mUnits * price;
                const cogs = mUnits * costU;
                const iibb = rev * (safe(p.iibbRate)/100);
                const fees = rev * (safe(p.gatewayFee)/100);
                const mkt = (mUnits * (safe(p.salesGrowth)/100)) * safe(p.cacCost) * inf;
                const mFixed = mFixedBase * inf;

                const cStaff = p.staff.reduce((acc, s) => {
                    const base = (safe(s.basic) + safe(s.additional)) * inf;
                    const patr = safe(s.employerTaxesRate) / 100;
                    const sac = (i === 6 || i === 12) ? (base * 0.5) : 0;
                    return acc + (base + sac) * (1 + patr);
                }, 0);

                const ebitda = rev - cogs - cStaff - mFixed - iibb - fees - mkt;
                const mInt = loanBal * (safe(p.loanRate)/100/12);
                const capRepay = (i <= safe(p.loanTerm)) ? (safe(p.loanAmount)/safe(p.loanTerm)) : 0;
                loanBal = Math.max(0, loanBal - capRepay);
                const ebt = ebitda - mDepr - mInt;
                const tax = ebt > 0 ? ebt * (safe(p.taxRate)/100) : 0;
                const net = ebt - tax;

                revHist[i] = rev;
                const collected = safe(p.collectionDays) >= 30 ? (revHist[i-1] || 0) : rev;
                const nextUnits = units * (1 + (safe(p.salesGrowth)/100)) * (p.seasonality[i] || 1) * sMult;
                const targetInv = nextUnits * costU * safe(p.safetyStockMonths);
                const currInv = mUnits * costU * safe(p.safetyStockMonths);
                const stockInv = targetInv - currInv;

                const cf = net + mDepr - capRepay - stockInv - (rev - collected);
                cumCash += cf;
                accDepr += mDepr;
                if (cumCash >= 0 && payback === null) payback = i;

                months.push({ m: `M${i}`, rev, ebitda, net, cf, cumCash, debtService: mInt + capRepay });
                units *= (1 + (safe(p.salesGrowth) / 100));
            }

            return {
                months,
                van: months[11]?.cumCash || 0,
                avgPrice, avgCost,
                totalEbitda: months.reduce((a,b)=>a+b.ebitda, 0),
                totalRev: months.reduce((a,b)=>a+b.rev, 0),
                mFixedTotal: mFixedBase + (p.staff.reduce((acc, s) => acc + (safe(s.basic)+safe(s.additional))*(1+safe(s.employerTaxesRate)/100), 0)),
                payback, equity
            };
        };

        function App() {
            const [activeTab, setActiveTab] = useState('config');
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [scenario, setScenario] = useState('base');

            // --- ESTADOS ---
            const [investment, setInvestment] = useState(0);
            const [discountRate, setDiscountRate] = useState(15);
            const [inflationRate, setInflationRate] = useState(0);
            const [taxRate, setTaxRate] = useState(30);
            const [ivaRate, setIvaRate] = useState(21);
            const [iibbRate, setIibbRate] = useState(3.5);
            const [gatewayFee, setGatewayFee] = useState(5);
            const [safetyStockMonths, setSafetyStockMonths] = useState(1);
            const [collectionDays, setCollectionDays] = useState(0);
            const [cacCost, setCacCost] = useState(0);
            const [loanAmount, setLoanAmount] = useState(0);
            const [loanRate, setLoanRate] = useState(45);
            const [loanTerm, setLoanTerm] = useState(12);
            const [products, setProducts] = useState([]);
            const [staff, setStaff] = useState([]);
            const [fixedCosts, setFixedCosts] = useState([]);
            const [assets, setAssets] = useState([]);
            const [initialUnitsTotal, setInitialUnitsTotal] = useState(0);
            const [salesGrowth, setSalesGrowth] = useState(0);
            const [seasonality, setSeasonality] = useState(Array(12).fill(1));

            const results = useMemo(() => runFinancialEngine({
                investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee,
                safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm,
                products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality, scenario
            }), [investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee, safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm, products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality, scenario]);

            const dailyUnits = Math.ceil((results.mFixedTotal / (results.avgPrice - results.avgCost || 1)) / 22);
            const dscr = (results.totalEbitda / 12) / (loanAmount > 0 ? results.months[0].debtService : 1);

            const NavItem = ({ id, icon: Icon, label }) => (
                <button onClick={()=>setActiveTab(id)} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-2xl transition-all ${activeTab === id ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800'}`}>
                    <Icon size={18}/> {isSidebarOpen && <span className="text-sm font-bold">{label}</span>}
                </button>
            );

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* SIDEBAR */}
                    <aside className={`transition-all duration-300 bg-slate-900 border-r border-slate-800 p-4 flex flex-col ${isSidebarOpen ? 'w-64' : 'w-20'}`}>
                        <div className="flex items-center justify-between mb-8 px-2">
                            {isSidebarOpen && <div className="flex items-center gap-2 font-black text-xl text-indigo-400"><Scale size={22}/> MASTER STRAT</div>}
                            <button onClick={()=>setIsSidebarOpen(!isSidebarOpen)} className="p-2 hover:bg-slate-800 rounded-xl text-slate-400 mx-auto">
                                {isSidebarOpen ? <ChevronLeft size={20}/> : <Menu size={20}/>}
                            </button>
                        </div>
                        <nav className="flex-1 space-y-1 overflow-y-auto custom-scrollbar">
                            <NavItem id="config" icon={Settings} label="Modelo Base"/>
                            <NavItem id="strategy" icon={Zap} label="Impuestos/Caja"/>
                            <NavItem id="products" icon={ShoppingCart} label="Cat谩logo"/>
                            <NavItem id="staff" icon={Users} label="N贸mina"/>
                            <NavItem id="goals" icon={Target} label="Operativo"/>
                            <NavItem id="flow" icon={Activity} label="Cash Flow"/>
                            <NavItem id="analysis" icon={Gauge} label="Rentabilidad"/>
                        </nav>
                        <div className="pt-4 border-t border-slate-800 space-y-4">
                            {isSidebarOpen && <select value={scenario} onChange={e=>setScenario(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-xs font-bold outline-none cursor-pointer">
                                <option value="base"> Base</option>
                                <option value="optimistic"> Optimista</option>
                                <option value="pessimistic"> Pesimista</option>
                            </select>}
                            <button className="w-full bg-indigo-600 py-3 rounded-2xl text-xs font-black shadow-lg flex items-center justify-center gap-2">
                                <Save size={16}/> {isSidebarOpen && "GUARDAR"}
                            </button>
                        </div>
                    </aside>

                    {/* MAIN */}
                    <main className="flex-1 overflow-y-auto p-4 md:p-10 bg-[#020617]">
                        {activeTab === 'config' && (
                            <div className="max-w-5xl mx-auto space-y-8 animate-in">
                                <h2 className="text-3xl font-black italic underline decoration-indigo-500">Par谩metros de Inversi贸n</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-slate-900 p-6 rounded-[32px] border border-slate-800 shadow-xl space-y-6">
                                        <h3 className="text-indigo-400 font-black text-[10px] uppercase flex items-center gap-2"><DollarSign size={14}/> Capital</h3>
                                        <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                            <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Inversi贸n Total ($)</label>
                                            <input type="number" value={investment} onChange={e=>setInvestment(safe(e.target.value))} className="w-full bg-transparent border-none text-2xl font-mono outline-none" />
                                        </div>
                                        <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                            <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Pr茅stamo ($)</label>
                                            <input type="number" value={loanAmount} onChange={e=>setLoanAmount(safe(e.target.value))} className="w-full bg-transparent border-none text-xl font-mono outline-none text-indigo-400" />
                                        </div>
                                    </div>
                                    <div className="bg-slate-900 p-6 rounded-[32px] border border-slate-800 shadow-xl space-y-6">
                                        <h3 className="text-orange-400 font-black text-[10px] uppercase flex items-center gap-2"><Thermometer size={14}/> Macro</h3>
                                        <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                            <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Inflaci贸n Mensual (%)</label>
                                            <input type="number" value={inflationRate} onChange={e=>setInflationRate(safe(e.target.value))} className="w-full bg-transparent text-xl font-mono outline-none" />
                                        </div>
                                        <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                            <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Ventas M1 (Unid.)</label>
                                            <input type="number" value={initialUnitsTotal} onChange={e=>setInitialUnitsTotal(safe(e.target.value))} className="w-full bg-transparent text-xl font-mono outline-none text-emerald-400" />
                                        </div>
                                    </div>
                                    <div className="bg-slate-900 p-6 rounded-[32px] border border-slate-800 shadow-xl space-y-4">
                                        <div className="flex justify-between items-center font-bold text-[10px] text-purple-400 uppercase tracking-widest">
                                            <span>Gastos Fijos</span>
                                            <button onClick={()=>setFixedCosts([...fixedCosts, {id: Date.now(), amount: 0}])} className="p-1 hover:bg-slate-800 rounded-lg"><Plus size={16}/></button>
                                        </div>
                                        <div className="space-y-2 max-h-[180px] overflow-y-auto custom-scrollbar">
                                            {fixedCosts.map(c => (
                                                <div key={c.id} className="flex gap-2 group bg-slate-950 p-2 rounded-xl border border-slate-800">
                                                    <input placeholder="Gasto" className="flex-1 bg-transparent text-[10px] outline-none" value={c.concept} onChange={e=>setFixedCosts(fixedCosts.map(x=>x.id===c.id?{...x, concept: e.target.value}:x))} />
                                                    <input type="number" className="w-16 bg-transparent text-[10px] font-mono text-right outline-none" value={c.amount} onChange={e=>setFixedCosts(fixedCosts.map(x=>x.id===c.id?{...x, amount: safe(e.target.value)}:x))} />
                                                    <button onClick={()=>setFixedCosts(fixedCosts.filter(x=>x.id!==c.id))} className="text-slate-700 hover:text-red-500"><Trash2 size={12}/></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'goals' && (
                            <div className="max-w-5xl mx-auto space-y-8 animate-in pb-20">
                                <h2 className="text-3xl font-black italic underline decoration-indigo-500">M茅tricas de Control Diario</h2>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                    <div className="bg-slate-900 p-8 rounded-[40px] border border-slate-800 shadow-2xl">
                                        <p className="text-[10px] font-black text-slate-500 uppercase mb-2">Meta Diaria (Unid)</p>
                                        <h3 className="text-5xl font-black text-indigo-400 font-mono">{dailyUnits}</h3>
                                        <p className="text-[9px] text-slate-600 mt-2 font-black uppercase">Unidades hoy</p>
                                    </div>
                                    <div className="bg-slate-900 p-8 rounded-[40px] border border-slate-800 shadow-2xl">
                                        <p className="text-[10px] font-black text-slate-500 uppercase mb-2">DSCR Bancario</p>
                                        <h3 className={`text-4xl font-black ${dscr >= 1.2 ? 'text-emerald-400' : 'text-red-400'} font-mono`}>{dscr.toFixed(2)}</h3>
                                        <p className="text-[9px] text-slate-600 mt-2 font-black uppercase">Score cobertura</p>
                                    </div>
                                    <div className="bg-slate-900 p-8 rounded-[40px] border border-slate-800 shadow-2xl">
                                        <p className="text-[10px] font-black text-slate-500 uppercase mb-2">Margen Unit.</p>
                                        <h3 className="text-4xl font-black text-white font-mono">{formatUSD(results.avgPrice - results.avgCost)}</h3>
                                        <p className="text-[9px] text-slate-600 mt-2 font-black uppercase">Ganancia x unidad</p>
                                    </div>
                                    <div className="bg-slate-900 p-8 rounded-[40px] border border-slate-800 shadow-2xl text-center">
                                        <p className="text-[10px] font-black text-slate-500 uppercase mb-2">Payback</p>
                                        <h3 className="text-4xl font-black text-indigo-400 font-mono">{results.payback || 'N/A'}</h3>
                                        <p className="text-[9px] text-slate-600 mt-2 font-black uppercase">Mes recupero</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'flow' && (
                            <div className="max-w-6xl mx-auto animate-in pb-20 overflow-x-auto">
                                <h2 className="text-3xl font-black italic mb-8">Flujo de Fondos (Caja)</h2>
                                <div className="bg-slate-900 border border-slate-800 rounded-[32px] overflow-hidden shadow-2xl">
                                    <table className="w-full text-left text-xs">
                                        <thead className="bg-slate-800/80 border-b border-slate-700 font-mono text-indigo-400">
                                            <tr><th className="px-8 py-5 uppercase text-slate-500">L铆nea de Caja</th>{results.months.map((m, i) => <th key={i} className="px-4 py-5 text-right min-w-[110px]">{m.m}</th>)}</tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-800/50">
                                            <tr><td className="px-8 py-4 font-bold text-slate-300">Ingresos Totales</td>{results.months.map((m, i) => <td key={i} className="px-4 py-4 text-right font-mono text-emerald-400">{formatUSD(m.rev)}</td>)}</tr>
                                            <tr className="bg-indigo-500/5"><td className="px-8 py-4 font-black text-indigo-300 italic uppercase">EBITDA</td>{results.months.map((m, i) => <td key={i} className="px-4 py-4 text-right font-mono font-bold text-indigo-300">{formatUSD(m.ebitda)}</td>)}</tr>
                                            <tr className="bg-slate-950 font-black"><td className="px-8 py-6 text-white text-sm">CASH FLOW NETO</td>{results.months.map((m, i) => <td key={i} className="px-4 py-6 text-right font-mono text-lg text-blue-400">{formatUSD(m.cf)}</td>)}</tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* RENDER RESTO DE TABS (Omitidos para brevedad, misma l贸gica estructural) */}
                        <div className="mt-20 text-center opacity-20 text-[10px] font-bold uppercase tracking-widest italic">Biz Strategist Executive Edition v10.0</div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

