<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIZ-STRATEGIST Executive Mastery v10</title>
    
    <!-- LIBRERIAS BASE -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>

    <!-- FIREBASE SDK COMPAT -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; margin: 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.4); }
        .tab-animate { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIGURACIN DE FIREBASE (TU CONFIGURACIN INTEGRADA) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBpIUJfaVxDBZZo14ph26fZ--2L5Tfm1NI",
            authDomain: "cash-flow-4aac7.firebaseapp.com",
            projectId: "cash-flow-4aac7",
            storageBucket: "cash-flow-4aac7.firebasestorage.app",
            messagingSenderId: "561130385612",
            appId: "1:561130385612:web:20028060976a759eab9269"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const { useState, useMemo, useEffect } = React;
        const {
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, 
            Legend, ResponsiveContainer, AreaChart, Area, Radar, RadarChart, 
            PolarGrid, PolarAngleAxis, BarChart, Bar, Cell
        } = Recharts;

        // --- ICONOS ---
        const Icon = ({ name, size = 18, className = "" }) => {
            const LucideIcon = lucide[name] || lucide.HelpCircle;
            return <LucideIcon size={size} className={className} />;
        };

        // --- UTILIDADES ---
        const safe = (v, fb = 0) => {
            const n = parseFloat(v);
            return isNaN(n) || !isFinite(n) ? fb : n;
        };

        const fmt = (v) => new Intl.NumberFormat('es-AR', { 
            style: 'currency', currency: 'USD', maximumFractionDigits: 0 
        }).format(v);

        // --- MOTOR DE PROYECCIN EJECUTIVA ---
        const runFinancialEngine = (p) => {
            const months = [];
            const scenarioMult = p.scenario === 'optimistic' ? 1.25 : p.scenario === 'pessimistic' ? 0.75 : 1;
            const mDepr = p.assets.reduce((a, b) => a + (safe(b.value) / (safe(b.life || 1) * 12)), 0);
            const mFixedBase = p.fixedCosts.reduce((a, b) => a + safe(b.amount), 0);
            
            const totalProd = p.products.length || 1;
            const avgCost = p.products.reduce((acc, x) => acc + safe(x.cost), 0) / totalProd;
            const avgMargin = p.products.reduce((acc, x) => acc + safe(x.margin), 0) / totalProd;
            const avgPrice = avgCost * (1 + avgMargin / 100);

            let units = safe(p.initialUnitsTotal);
            let equity = safe(p.investment) - safe(p.loanAmount);
            let cumCash = -equity;
            let loanBal = safe(p.loanAmount);
            let retainedEarnings = 0;
            let accDepr = 0;
            let revHistory = Array(15).fill(0);
            let payback = null;

            for (let i = 1; i <= 12; i++) {
                const inf = Math.pow(1 + (safe(p.inflationRate)/100), i);
                const season = p.seasonality[i-1] || 1;
                const mUnits = units * season * scenarioMult;
                
                const price = avgPrice * inf;
                const costU = avgCost * inf;
                const rev = mUnits * price;
                const cogs = mUnits * costU;

                // Gastos Fijos
                const mFixed = mFixedBase * inf;
                const iibb = rev * (safe(p.iibbRate)/100);
                const gateway = rev * (safe(p.gatewayFee)/100);
                const mkt = (mUnits * (safe(p.salesGrowth)/100)) * safe(p.cacCost) * inf;

                // N贸mina y SAC (Aguinaldo Junio/Diciembre)
                const cStaff = p.staff.reduce((acc, s) => {
                    const base = (safe(s.basic) + safe(s.additional)) * inf;
                    const patr = safe(s.employerTaxesRate) / 100;
                    const sac = (i === 6 || i === 12) ? (base * 0.5) : 0;
                    return acc + (base + sac) * (1 + patr);
                }, 0);

                const ebitda = rev - cogs - cStaff - mFixed - iibb - gateway - mkt;
                
                // Deuda
                const mRate = (safe(p.loanRate)/100/12);
                const mInt = loanBal * mRate;
                const capRepay = (i <= safe(p.loanTerm)) ? (safe(p.loanAmount)/safe(p.loanTerm)) : 0;
                loanBal = Math.max(0, loanBal - capRepay);

                const ebt = ebitda - mDepr - mInt;
                const tax = ebt > 0 ? ebt * (safe(p.taxRate)/100) : 0;
                const net = ebt - tax;

                // Caja
                revHistory[i] = rev;
                const cashIn = safe(p.collectionDays) >= 30 ? (revHistory[i-1] || 0) : rev;
                const nextUnits = units * (1 + (safe(p.salesGrowth)/100)) * (p.seasonality[i] || 1) * scenarioMult;
                const stockInv = (nextUnits * costU * safe(p.safetyStockMonths)) - (mUnits * costU * safe(p.safetyStockMonths));

                const cf = net + mDepr - capRepay - stockInv - (rev - cashIn);
                cumCash += cf;
                accDepr += mDepr;
                retainedEarnings += net;
                if (cumCash >= 0 && payback === null) payback = i;

                months.push({ 
                    m: `M${i}`, rev, ebitda, net, cf, cumCash, 
                    debt: loanBal, equity: equity + retainedEarnings,
                    assets: { cash: cumCash, inv: mUnits * costU * safe(p.safetyStockMonths), fixed: safe(p.investment) - accDepr },
                    debtSrv: mInt + capRepay
                });
                units *= (1 + (safe(p.salesGrowth) / 100));
            }

            return {
                months, van: months[11]?.cumCash + (months[11]?.cf * 15), 
                avgPrice, avgCost, payback, equity,
                totalEbitda: months.reduce((a,b)=>a+b.ebitda, 0),
                totalRev: months.reduce((a,b)=>a+b.rev, 0),
                mFixedTotal: mFixedBase + (p.staff.reduce((acc, s) => acc + (safe(s.basic)+safe(s.additional))*(1+safe(s.employerTaxesRate)/100), 0))
            };
        };

        // --- APP ---
        function App() {
            const [activeTab, setActiveTab] = useState('config');
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [scenario, setScenario] = useState('base');
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [saveStatus, setSaveStatus] = useState('');

            // DATOS
            const [investment, setInvestment] = useState(0);
            const [discountRate, setDiscountRate] = useState(15);
            const [inflationRate, setInflationRate] = useState(0);
            const [taxRate, setTaxRate] = useState(30);
            const [ivaRate, setIvaRate] = useState(21);
            const [iibbRate, setIibbRate] = useState(3.5);
            const [gatewayFee, setGatewayFee] = useState(5);
            const [safetyStockMonths, setSafetyStockMonths] = useState(1);
            const [collectionDays, setCollectionDays] = useState(0);
            const [cacCost, setCacCost] = useState(0);
            const [loanAmount, setLoanAmount] = useState(0);
            const [loanRate, setLoanRate] = useState(45);
            const [loanTerm, setLoanTerm] = useState(12);
            const [products, setProducts] = useState([]);
            const [staff, setStaff] = useState([]);
            const [fixedCosts, setFixedCosts] = useState([]);
            const [assets, setAssets] = useState([]);
            const [initialUnitsTotal, setInitialUnitsTotal] = useState(0);
            const [salesGrowth, setSalesGrowth] = useState(0);
            const [seasonality, setSeasonality] = useState(Array(12).fill(1));

            useEffect(() => {
                auth.onAuthStateChanged(async (u) => {
                    if (u) {
                        setUser(u);
                        const snap = await db.collection('users').doc(u.uid).get();
                        if (snap.exists) {
                            const d = snap.data();
                            setInvestment(d.investment || 0); setDiscountRate(d.discountRate || 15);
                            setProducts(d.products || []); setStaff(d.staff || []);
                            setFixedCosts(d.fixedCosts || []); setAssets(d.assets || []);
                            setInitialUnitsTotal(d.initialUnitsTotal || 0); setSalesGrowth(d.salesGrowth || 0);
                            setSeasonality(d.seasonality || Array(12).fill(1));
                        }
                    } else { auth.signInAnonymously(); }
                    setLoading(false);
                });
            }, []);

            const handleSave = async () => {
                if (!user) return;
                setSaveStatus('...');
                await db.collection('users').doc(user.uid).set({
                    investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate,
                    gatewayFee, safetyStockMonths, collectionDays, cacCost, loanAmount,
                    loanRate, loanTerm, products, staff, fixedCosts, assets,
                    initialUnitsTotal, salesGrowth, seasonality
                });
                setSaveStatus('OK');
                setTimeout(() => setSaveStatus(''), 2000);
            };

            const results = useMemo(() => runFinancialEngine({
                investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee,
                safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm,
                products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality, scenario
            }), [investment, discountRate, inflationRate, taxRate, ivaRate, iibbRate, gatewayFee, safetyStockMonths, collectionDays, cacCost, loanAmount, loanRate, loanTerm, products, staff, fixedCosts, assets, initialUnitsTotal, salesGrowth, seasonality, scenario]);

            const dailyGoal = Math.ceil((results.mFixedTotal / (results.avgPrice - results.avgCost || 1)) / 22);
            const dscr = (results.totalEbitda / 12) / (loanAmount > 0 ? results.months[0].debtSrv : 1);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-[#020617] text-indigo-500">
                    <Icon name="Loader2" size={56} className="animate-spin mb-4" />
                    <p className="font-bold tracking-[0.2em] uppercase opacity-50">Sincronizando con Firebase...</p>
                </div>
            );

            return (
                <div className="flex h-screen overflow-hidden text-slate-200">
                    {/* SIDEBAR */}
                    <aside className={`transition-all duration-300 bg-[#0f172a] border-r border-slate-800 p-4 flex flex-col ${isSidebarOpen ? 'w-64' : 'w-20'}`}>
                        <div className="flex items-center justify-between mb-10 px-2">
                            {isSidebarOpen && <div className="font-black text-xl text-indigo-400 flex items-center gap-2"><Icon name="Target" size={24}/> MASTER FIN</div>}
                            <button onClick={()=>setIsSidebarOpen(!isSidebarOpen)} className="p-2 hover:bg-slate-800 rounded-xl text-slate-400 mx-auto">
                                <Icon name={isSidebarOpen ? "ChevronLeft" : "Menu"} />
                            </button>
                        </div>
                        <nav className="flex-1 space-y-1.5 overflow-y-auto custom-scrollbar pr-1">
                            {[
                                { id: 'config', icon: 'Settings', label: 'Modelo Base' },
                                { id: 'strategy', icon: 'Zap', label: 'Estrategia Macro' },
                                { id: 'products', icon: 'ShoppingCart', label: 'Cat谩logo' },
                                { id: 'staff', icon: 'Users', label: 'N贸mina' },
                                { id: 'goals', icon: 'Crosshair', label: 'Metas Diarias' },
                                { id: 'flow', icon: 'Activity', label: 'Cash Flow' },
                                { id: 'balance', icon: 'Briefcase', label: 'Balance' },
                                { id: 'analysis', icon: 'Gauge', label: 'Rentabilidad' }
                            ].map(item => (
                                <button key={item.id} onClick={()=>setActiveTab(item.id)} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-2xl transition-all ${activeTab === item.id ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800'}`}>
                                    <Icon name={item.icon} size={18}/> {isSidebarOpen && <span className="text-sm font-bold">{item.label}</span>}
                                </button>
                            ))}
                        </nav>
                        <div className="pt-6 border-t border-slate-800 space-y-4">
                            {isSidebarOpen && <select value={scenario} onChange={e=>setScenario(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-xs font-bold outline-none cursor-pointer">
                                <option value="base"> Escenario Base</option>
                                <option value="optimistic"> Optimista (+25%)</option>
                                <option value="pessimistic"> Pesimista (-25%)</option>
                            </select>}
                            <button onClick={handleSave} className="w-full bg-indigo-600 py-3 rounded-2xl text-xs font-black shadow-lg flex items-center justify-center gap-2 hover:bg-indigo-500">
                                <Icon name="Save" size={16}/> {isSidebarOpen && (saveStatus || "GUARDAR")}
                            </button>
                        </div>
                    </aside>

                    {/* MAIN */}
                    <main className="flex-1 overflow-y-auto p-4 md:p-10 bg-[#020617] custom-scrollbar">
                        <div className="max-w-6xl mx-auto space-y-12 tab-animate">
                            
                            {activeTab === 'config' && (
                                <div className="space-y-8">
                                    <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 uppercase tracking-tighter text-white">Par谩metros de Capital</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-xl space-y-6">
                                            <h3 className="text-indigo-400 font-black text-[10px] uppercase flex items-center gap-2 tracking-widest"><Icon name="DollarSign" size={14}/> Inversi贸n Total</h3>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Inversi贸n Inicial ($)</label>
                                                <input type="number" value={investment} onChange={e=>setInvestment(safe(e.target.value))} className="w-full bg-transparent border-none text-2xl font-mono outline-none text-white" />
                                            </div>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Pr茅stamo Bancario ($)</label>
                                                <input type="number" value={loanAmount} onChange={e=>setLoanAmount(safe(e.target.value))} className="w-full bg-transparent border-none text-xl font-mono outline-none text-indigo-400" />
                                            </div>
                                        </div>
                                        <div className="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-xl space-y-6">
                                            <h3 className="text-orange-400 font-black text-[10px] uppercase flex items-center gap-2 tracking-widest"><Icon name="TrendingUp" size={14}/> Demanda M1</h3>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Unidades M1</label>
                                                <input type="number" value={initialUnitsTotal} onChange={e=>setInitialUnitsTotal(safe(e.target.value))} className="w-full bg-transparent border-none text-xl font-mono outline-none text-white" />
                                            </div>
                                            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                                                <label className="text-[10px] text-slate-500 font-bold uppercase block mb-1">Crecim. Mensual %</label>
                                                <input type="number" value={salesGrowth} onChange={e=>setSalesGrowth(safe(e.target.value))} className="w-full bg-transparent border-none text-xl font-mono outline-none text-emerald-400" />
                                            </div>
                                        </div>
                                        <div className="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-xl space-y-4">
                                            <div className="flex justify-between items-center font-black text-[10px] text-purple-400 uppercase tracking-widest">
                                                <span>Gastos Fijos</span>
                                                <button onClick={()=>setFixedCosts([...fixedCosts, {id: Date.now(), amount: 0}])} className="p-1 bg-purple-500/10 rounded-lg"><Icon name="Plus" size={16}/></button>
                                            </div>
                                            <div className="space-y-2 max-h-[180px] overflow-y-auto custom-scrollbar pr-2">
                                                {fixedCosts.map(c => (
                                                    <div key={c.id} className="flex gap-2 group bg-slate-950 p-2 rounded-xl border border-slate-800">
                                                        <input placeholder="Gasto" className="flex-1 bg-transparent text-[10px] outline-none" value={c.concept} onChange={e=>setFixedCosts(fixedCosts.map(x=>x.id===c.id?{...x, concept: e.target.value}:x))} />
                                                        <input type="number" className="w-16 bg-transparent text-[10px] font-mono text-right outline-none" value={c.amount} onChange={e=>setFixedCosts(fixedCosts.map(x=>x.id===c.id?{...x, amount: safe(e.target.value)}:x))} />
                                                        <button onClick={()=>setFixedCosts(fixedCosts.filter(x=>x.id!==c.id))} className="text-slate-700 hover:text-red-500"><Icon name="Trash2" size={12}/></button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'goals' && (
                                <div className="space-y-12 animate-in pb-20">
                                    <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 text-white uppercase tracking-tighter">Control Operativo Diario</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Meta Diaria (Unid)</p>
                                            <h3 className="text-6xl font-black text-indigo-400 font-mono">{dailyGoal}</h3>
                                            <p className="text-[9px] text-slate-600 mt-2 font-black uppercase tracking-[0.2em]">A vender hoy</p>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Caja Hoy</p>
                                            <h3 className="text-3xl font-black text-white font-mono">{fmt(dailyGoal * res.avgPrice)}</h3>
                                            <p className="text-[9px] text-slate-600 mt-2 font-black uppercase tracking-[0.2em]">Facturaci贸n M铆nima</p>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Score DSCR</p>
                                            <h3 className={`text-5xl font-black ${dscr >= 1.2 ? 'text-emerald-400' : 'text-red-400'} font-mono`}>{dscr.toFixed(2)}</h3>
                                            <p className="text-[9px] text-slate-600 mt-2 font-black uppercase tracking-[0.2em]">Cobertura Deuda</p>
                                        </div>
                                        <div className="glass p-10 rounded-[48px] shadow-2xl">
                                            <p className="text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Eq. Mensual</p>
                                            <h3 className="text-4xl font-black text-white font-mono">{Math.ceil(res.mFixedTotal / (res.avgPrice - res.avgCost || 1))}</h3>
                                            <p className="text-[9px] text-slate-600 mt-2 font-black uppercase tracking-[0.2em]">Unidades Cr铆ticas</p>
                                        </div>
                                    </div>
                                    <div className="bg-indigo-600/10 p-10 rounded-[60px] border border-indigo-600/20 flex flex-col md:flex-row gap-10 items-center shadow-2xl">
                                        <div className="w-24 h-24 bg-indigo-600 rounded-full flex items-center justify-center shadow-indigo-600/40 shadow-2xl"><Icon name="CheckCircle2" size={48} className="text-white"/></div>
                                        <div className="flex-1">
                                            <h4 className="text-2xl font-black text-white uppercase tracking-tighter italic">Dictamen de Salud Financiera</h4>
                                            <p className="text-slate-400 text-base italic leading-relaxed mt-2">
                                                {dscr >= 1.2 ? "Excelente: Tu negocio genera suficiente excedente tras cubrir la cuota bancaria. Es altamente financiable y s贸lido para el crecimiento." : "Alerta de Liquidez: El EBITDA apenas cubre los pr茅stamos. Se requiere bajar costos fijos o aumentar el margen de producto."}
                                                <br/><br/>
                                                <span className="text-indigo-400 font-black">Meta Hoy:</span> Deb茅s asegurar facturar {fmt(dailyGoal * res.avgPrice)} para proteger tu inversi贸n.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'flow' && (
                                <div className="space-y-10 animate-in pb-20 overflow-x-auto">
                                    <h2 className="text-3xl font-black italic border-l-4 border-blue-500 pl-4 text-white uppercase tracking-tighter">Estado de Resultados y Caja</h2>
                                    <div className="bg-[#0f172a] border border-slate-800 rounded-[40px] overflow-hidden shadow-2xl">
                                        <table className="w-full text-left text-xs">
                                            <thead className="bg-slate-800/80 border-b border-slate-700">
                                                <tr><th className="px-8 py-6 font-black uppercase text-slate-500 tracking-widest">CONCEPTO</th>{res.months.map((p, i) => <th key={i} className="px-4 py-6 text-right font-mono text-indigo-400 min-w-[120px]">{p.m}</th>)}</tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-800/40">
                                                <tr className="hover:bg-white/5 transition-colors"><td className="px-8 py-5 font-bold text-slate-300 italic">Ventas Brutas</td>{res.months.map((p, i) => <td key={i} className="px-4 py-5 text-right font-mono text-emerald-400">{fmt(p.rev)}</td>)}</tr>
                                                <tr className="bg-indigo-500/5 transition-colors font-black"><td className="px-8 py-5 font-black text-indigo-300 uppercase text-[10px] tracking-widest italic">EBITDA Real</td>{res.months.map((p, i) => <td key={i} className="px-4 py-5 text-right font-mono font-bold text-indigo-300">{fmt(p.ebitda)}</td>)}</tr>
                                                <tr className="bg-slate-950 font-black"><td className="px-8 py-8 text-white text-base">CASH FLOW FINAL</td>{res.months.map((p, i) => <td key={i} className="px-6 py-8 text-right font-mono text-xl text-blue-400 tracking-tighter">{fmt(p.cf)}</td>)}</tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'analysis' && (
                                <div className="space-y-12 animate-in pb-20">
                                    <h2 className="text-3xl font-black italic border-l-4 border-indigo-500 pl-4 text-white uppercase tracking-tighter">Dashboards de Rentabilidad</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                                        <div className="glass p-10 rounded-[60px] flex flex-col items-center">
                                            <h4 className="text-xs font-black text-slate-500 uppercase tracking-widest mb-10 italic">Atributos del Proyecto</h4>
                                            <div className="h-[380px] w-full">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <RadarChart cx="50%" cy="50%" outerRadius="80%" data={[
                                                        { s: 'EBITDA', v: Math.min(100, (res.totalEbitda/res.totalRev)*200) || 0 },
                                                        { s: 'VAN+', v: res.van > 0 ? 95 : 20 },
                                                        { s: 'Bancabilidad', v: Math.min(100, dscr * 50) || 0 },
                                                        { s: 'Escalabilidad', v: Math.min(100, salesGrowth*5) || 0 },
                                                        { s: 'Liquidez', v: (12 - (res.payback || 12)) * 8.3 }
                                                    ]}>
                                                        <PolarGrid stroke="#334155" />
                                                        <PolarAngleAxis dataKey="s" tick={{ fill: '#94a3b8', fontSize: 10, fontWeight: '900' }} />
                                                        <Radar name="Biz" dataKey="v" stroke="#6366f1" fill="#6366f1" fillOpacity={0.6} />
                                                    </RadarChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                        <div className="space-y-8 flex flex-col justify-center">
                                            <div className="bg-slate-900 p-10 rounded-[48px] border-2 border-indigo-500/20 shadow-2xl relative overflow-hidden bg-gradient-to-br from-slate-900 to-indigo-950/20 group">
                                                <Icon name="DollarSign" size={100} className="absolute top-0 right-0 p-4 opacity-5 group-hover:scale-110 transition-transform"/>
                                                <p className="text-xs font-black text-indigo-400 uppercase mb-2 tracking-widest">Valor Actual Neto (VAN)</p>
                                                <h3 className={`text-6xl font-black ${res.van >= 0 ? 'text-white' : 'text-red-400'} font-mono tracking-tighter`}>{fmt(res.van)}</h3>
                                                <p className="text-[10px] text-slate-500 mt-6 font-bold italic leading-relaxed">Incluye valorizaci贸n perpetua del negocio descontada a tasa WACC.</p>
                                            </div>
                                            <div className="grid grid-cols-2 gap-6 text-center">
                                                <div className="bg-slate-900 p-8 rounded-[40px] border border-slate-800 shadow-xl"><p className="text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Recupero</p><h4 className="text-4xl font-black text-white font-mono">{res.payback || 'N/A'} M</h4></div>
                                                <div className="bg-slate-900 p-8 rounded-[40px] border border-slate-800 shadow-xl"><p className="text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Valuaci贸n Llave</p><h4 className="text-3xl font-black text-emerald-400 font-mono">{fmt(res.totalEbitda * 3.5)}</h4></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Otros Tabs (Strategy, Products, Staff, Balance) - Mantienen la misma estructura */}
                            <div className="mt-20 py-20 border-t border-slate-900 text-center">
                                <p className="text-[10px] font-black text-slate-700 uppercase tracking-[1em] italic">Biz Strategist Supreme v10.0</p>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

